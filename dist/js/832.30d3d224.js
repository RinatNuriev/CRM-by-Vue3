"use strict";(self["webpackChunkvue_crm"]=self["webpackChunkvue_crm"]||[]).push([[832],{832:function(e,t,i){i.r(t),i.d(t,{default:function(){return V}});var s=i(3396),a=i(9242),n=i(7139);const l=(0,s._)("div",{class:"page-title"},[(0,s._)("h3",null,"Новая запись")],-1),o={key:1,class:"center"},r={class:"input-field"},u=["value"],c=(0,s._)("label",null,"Выберите категорию",-1),d=(0,s._)("span",null,"Доход",-1),p=(0,s._)("span",null,"Расход",-1),m={class:"input-field"},h=(0,s._)("label",{for:"amount"},"Сумма",-1),g={class:"input-field"},y=(0,s._)("label",{for:"description"},"Описание",-1),v=(0,s._)("button",{class:"btn waves-effect waves-light",type:"submit"},[(0,s.Uk)(" Создать "),(0,s._)("i",{class:"material-icons right"},"send")],-1);function w(e,t,i,w,$,f){const _=(0,s.up)("loader"),b=(0,s.up)("router-link");return(0,s.wg)(),(0,s.iD)("div",null,[l,$.loading?((0,s.wg)(),(0,s.j4)(_,{key:0})):$.categories.length?((0,s.wg)(),(0,s.iD)("form",{key:2,class:"form",onSubmit:t[5]||(t[5]=(0,a.iM)(((...e)=>f.submitHandler&&f.submitHandler(...e)),["prevent"]))},[(0,s._)("div",r,[(0,s.wy)((0,s._)("select",{ref:"select","onUpdate:modelValue":t[0]||(t[0]=e=>$.category=e)},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)($.categories[0],(e=>((0,s.wg)(),(0,s.iD)("option",{key:e.id,value:e.id},(0,n.zw)(e.title),9,u)))),128))],512),[[a.bM,$.category]]),c]),(0,s._)("p",null,[(0,s._)("label",null,[(0,s.wy)((0,s._)("input",{class:"with-gap",name:"type",type:"radio",value:"income","onUpdate:modelValue":t[1]||(t[1]=e=>$.type=e)},null,512),[[a.G2,$.type]]),d])]),(0,s._)("p",null,[(0,s._)("label",null,[(0,s.wy)((0,s._)("input",{class:"with-gap",name:"type",type:"radio",value:"outcome","onUpdate:modelValue":t[2]||(t[2]=e=>$.type=e)},null,512),[[a.G2,$.type]]),p])]),(0,s._)("div",m,[(0,s.wy)((0,s._)("input",{id:"amount",type:"number","onUpdate:modelValue":t[3]||(t[3]=e=>$.amount=e),class:(0,n.C_)({invalid:e.v$.amount.dirty&&!e.v$.amount.minValue})},null,2),[[a.nr,$.amount,void 0,{number:!0}]]),h,((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.v$.amount.$errors,(e=>((0,s.wg)(),(0,s.iD)("span",{class:"helper-text invalid",key:e.$uid},(0,n.zw)(e.$message),1)))),128))]),(0,s._)("div",g,[(0,s.wy)((0,s._)("input",{id:"description",type:"text","onUpdate:modelValue":t[4]||(t[4]=e=>$.description=e),class:(0,n.C_)({invalid:e.v$.description.dirty&&!e.v$.description.required})},null,2),[[a.nr,$.description]]),y,((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.v$.description.$errors,(e=>((0,s.wg)(),(0,s.iD)("span",{class:"helper-text invalid",key:e.$uid},(0,n.zw)(e.$message),1)))),128))]),v],32)):((0,s.wg)(),(0,s.iD)("p",o,[(0,s.Uk)("Категорий пока нет "),(0,s.Wm)(b,{to:"/categories"},{default:(0,s.w5)((()=>[(0,s.Uk)("Добавить категорию")])),_:1})]))])}var $=i(3053),f=i(9117),_=i(5778),b=i.n(_),k=i(4667),D=i(65),C={name:"record",data(){return{loading:!0,select:null,categories:[],type:"outcome",amount:1,description:"",category:null}},setup:()=>({v$:(0,$.Xw)()}),validations:{description:{required:f.BM.withMessage("Введите название",f.C1)},amount:{required:f.BM.withMessage("Укажите сумму",f.C1),minValue:f.BM.withMessage((({$params:e})=>`Минимальная величина - ${e.min}`),(0,f.uv)(1))}},async mounted(){this.categories=await this.$store.dispatch("fetchCategories"),this.loading=!1,this.categories.length&&(this.category=this.categories[0][0].id),setTimeout((()=>{this.select=b().FormSelect.init(this.$refs.select,{}),b().updateTextFields()}),0)},unmounted(){this.select&&this.select.destroy&&this.select.destroy()},components:{Loader:k.Z},methods:{async submitHandler(){if(this.v$.$invalid)this.v$.$touch();else if(this.canCreateRecord)try{await this.$store.dispatch("createRecord",{categoryId:this.category,amount:this.amount,description:this.description,type:this.type,date:(new Date).toJSON()});const e="income"===this.type?this.info.bill+this.amount:this.info.bill-this.amount;await this.$store.dispatch("unpdateInfo",{bill:e}),this.$message("Запись успешно добавлена"),this.v$.$reset(),this.amount=1,this.description=""}catch(e){e.message}else this.$message(`Недостаточно средств на счете (${this.amount-this.info.bill})`)}},computed:{...(0,D.Se)(["info"]),canCreateRecord(){return"income"===this.type||this.info.bill>=this.amount}}},M=i(89);const U=(0,M.Z)(C,[["render",w]]);var V=U}}]);
//# sourceMappingURL=832.30d3d224.js.map